{% extends 'base.html' %}
{% block title %}문제{% endblock %}
{% block style %}
<style type="text/css">
.set {
width:500px;
margin:0 auto;
}
.modal-score{
padding:10px;
margin-bottom:0;
}
.flag-submit{
margin:0 auto 0 0;
}
</style>
{% endblock %}
{% block content %}
<div class="set">
{% if problist %}
<ul>
    {% for prob in problist %}
    <li><button class="chall btn" name="{{prob.id}}">{{prob.title}}</button></li>
    {% endfor %}
</ul>
{% else %}
<p>현재 공개된 문제가 없습니다.</p>
{% endif %}
</div>
<div class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- header -->
            <div class="modal-header">
                <!-- title -->
                <h4 class="modal-title">Header</h4>
                <!-- score -->
                <h6 class="modal-score">score</h6>
                <!-- close button -->
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
            <!-- body -->
            <div class="modal-body">
            Body
            </div>
            <div class="modal-link"></div>
            <div class="modal-file"></div>
            <!-- Footer -->
            <div class="modal-footer">
                <form class="flag-submit" id="flagform">
                    <input class="modal-input" type="text" size="40" name="flag" placeholder="flag 입력">
                    <input type="submit" class="btn btn-default" value="제출">
                </form>
                <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block script %}
<script type="text/javascript">
    var pk = null;
    $(".chall").click(function(){
        pk = $(this).attr('name')
        $.ajax({
            type: "POST",
            url: "{% url 'chall:prob_select' %}",
            data: {'pk': pk, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
            dataType: "json",
            success: function(response){
                $(".modal-title").text(response.title);
                $(".modal-score").text(response.score);
                $(".modal-body").text(response.description);
                $('div.modal').modal();
            },
            error: function(request, status, error){
                alert("error");
                window.location.replace("{% url 'account:signin' %}");
            },
        });
    })
    $("#flagform").on('submit',function(){
        if (pk == null){
            alert("error");
        } else{
            $.ajax({
                type: "POST",
                url: "{% url 'chall:prob_auth' %}",
                data: {'pk': pk, 'csrfmiddlewaretoken': '{{ csrf_token }}', 'flag': $(},
                dataType: "json",
                success: function(){
                },
                error: function(){
                },
            });
        }
    })
</script>
{% endblock %}
